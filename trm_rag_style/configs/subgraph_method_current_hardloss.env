# Current subgraph-hardloss training snapshot.
# Uses ":=" so user-provided env values still win.

: "${DATASET:=cwq}"
: "${MODEL_IMPL:=trm_hier6}"
: "${EMB_MODEL:=intfloat/multilingual-e5-large}"
: "${EMB_TAG:=e5_w4_g4}"
: "${EMB_DIR:=trm_agent/emb/cwq_e5_w4_g4}"

# Training/eval
: "${EPOCHS:=10}"
: "${BATCH_SIZE:=1}"
: "${LR:=1e-6}"
: "${EVAL_LIMIT:=-1}"
: "${EVAL_EVERY_EPOCHS:=1}"
: "${EVAL_START_EPOCH:=1}"
: "${TRAIN_EVAL_SPLIT:=dev}"
: "${AUTO_TEST_AFTER_TRAIN:=true}"

# Subgraph reader shape
: "${SUBGRAPH_HOPS:=3}"
: "${SUBGRAPH_MAX_NODES:=2048}"
: "${SUBGRAPH_MAX_EDGES:=8192}"
: "${SUBGRAPH_RECURSION_STEPS:=16}"
: "${SUBGRAPH_DROPOUT:=0.1}"
: "${SUBGRAPH_POS_WEIGHT_MODE:=auto}"
: "${SUBGRAPH_POS_WEIGHT_MAX:=64}"

# Graph encoding options
: "${SUBGRAPH_SPLIT_REVERSE_RELATIONS:=false}"
: "${SUBGRAPH_DIRECTION_EMBEDDING_ENABLED:=false}"

# Hardloss options
: "${SUBGRAPH_BCE_HARD_NEGATIVE_ENABLED:=true}"
: "${SUBGRAPH_BCE_HARD_NEGATIVE_TOPK:=64}"
: "${SUBGRAPH_RANKING_ENABLED:=true}"
: "${SUBGRAPH_RANKING_WEIGHT:=0.1}"
: "${SUBGRAPH_RANKING_MARGIN:=0.5}"
: "${SUBGRAPH_HARD_NEGATIVE_TOPK:=16}"

# LR scheduler
: "${SUBGRAPH_LR_SCHEDULER:=none}"
: "${SUBGRAPH_LR_MIN:=0.0}"

# Runtime defaults
: "${WANDB_MODE:=online}"
: "${WANDB_PROJECT:=graph-traverse}"
: "${NPROC_PER_NODE:=4}"
: "${MASTER_PORT:=29612}"
: "${DDP_TIMEOUT_MINUTES:=180}"
: "${PYTORCH_CUDA_ALLOC_CONF:=expandable_segments:True}"
